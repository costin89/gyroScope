<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <title>Gyroskop-gesteuerte Three.js Kamera</title>
    <style>
      body {
        margin: 0;
        overflow: hidden;
      }
      #startButton {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 20px;
        padding: 10px 20px;
        z-index: 10;
      }
    </style>
  </head>
  <body>
    <!-- Button zum Anfordern der Berechtigung -->
    <button id="startButton">Gyroskop starten</button>

    <!-- three.js von einem CDN einbinden -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
      // Szene, Kamera und Renderer initialisieren
      const scene = new THREE.Scene();
      const camera = new THREE.PerspectiveCamera(
        75,
        window.innerWidth / window.innerHeight,
        0.1,
        1000
      );
      const renderer = new THREE.WebGLRenderer();
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.body.appendChild(renderer.domElement);

      // Ein Würfel als Referenzobjekt in der Szene
      const geometry = new THREE.BoxGeometry();
      const material = new THREE.MeshNormalMaterial();
      const cube = new THREE.Mesh(geometry, material);
      scene.add(cube);

      camera.position.z = 5;

      // Animationsschleife
      function animate() {
        requestAnimationFrame(animate);
        renderer.render(scene, camera);
      }
      animate();

      // Funktion zur Behandlung der DeviceOrientation-Events
      function handleOrientation(event) {
        // Auslesen der Rohwerte (in Grad)
        let beta = event.beta || 0;   // pitch
        let gamma = event.gamma || 0; // roll
        let alpha = event.alpha || 0; // yaw

        // Ermitteln der aktuellen Ausrichtung des Geräts (Portrait oder Landscape)
        // window.orientation liefert meist 0 (Portrait), 90 oder -90 (Landscape)
        let orientation = window.orientation || 0;
        let adjustedBeta = beta;
        let adjustedGamma = gamma;
        let adjustedAlpha = alpha;

        if (orientation === 90 || orientation === -90) {
          // Im Landscape-Modus können beta und gamma vertauscht bzw. invertiert werden
          adjustedBeta = gamma;
          adjustedGamma = -beta;
        }
        // Umrechnung in Radianten
        const pitch = THREE.Math.degToRad(adjustedBeta);
        const roll = THREE.Math.degToRad(adjustedGamma);
        const yaw = THREE.Math.degToRad(adjustedAlpha);

        // Anwendung der Winkel auf die Kamera.
        // Hier wird ein Euler-Winkel-System (YXZ) genutzt, das oft für Kamera-Rotationen sinnvoll ist.
        camera.rotation.set(pitch, yaw, roll, 'YXZ');

        // Zum Debuggen können die Werte in der Konsole ausgegeben werden:
        // console.log(`Pitch: ${pitch.toFixed(2)}, Roll: ${roll.toFixed(2)}, Yaw: ${yaw.toFixed(2)}`);
      }

      // Initialisierung des Gyroskops inkl. Berechtigungsanfrage (wichtig z.B. auf iOS)
      function initGyro() {
        if (window.DeviceOrientationEvent) {
          // Für iOS 13+ muss explizit um Erlaubnis gefragt werden
          if (typeof DeviceOrientationEvent.requestPermission === 'function') {
            DeviceOrientationEvent.requestPermission()
              .then((permissionState) => {
                if (permissionState === 'granted') {
                  window.addEventListener('deviceorientation', handleOrientation, true);
                  document.getElementById('startButton').style.display = 'none';
                } else {
                  alert("Berechtigung für den Gyroskop-Zugriff wurde nicht erteilt.");
                }
              })
              .catch((error) => {
                console.error("Fehler bei der Berechtigungsanfrage:", error);
              });
          } else {
            // Für Geräte/Browsers, die keine explizite Anfrage benötigen
            window.addEventListener('deviceorientation', handleOrientation, true);
            document.getElementById('startButton').style.display = 'none';
          }
        } else {
          alert("DeviceOrientationEvent wird von diesem Gerät/Broswer nicht unterstützt.");
        }
      }

      // Event-Listener für den Start-Button
      document.getElementById('startButton').addEventListener('click', initGyro);

      // Anpassen der Renderer-Größe bei Fensteränderung
      window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      });
    </script>
  </body>
</html>
